<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Arbuz WMS Academy</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* --- –ë–ê–ó–û–í–´–ï –ù–ê–°–¢–†–û–ô–ö–ò --- */
        :root {
            --arbuz-green: #00A046;
            --arbuz-red: #E21E2C;
            --dark-ui: #212121;
            --screen-bg: #F5F5F5;
            --hint-blue: #2196F3;
        }

        body {
            margin: 0; padding: 0; background-color: var(--dark-ui);
            font-family: 'Inter', sans-serif; height: 100vh;
            display: flex; justify-content: center; overflow: hidden;
            user-select: none;
        }

        .device-screen {
            background: var(--screen-bg); width: 100%; height: 100%;
            max-width: 480px; display: flex; flex-direction: column; position: relative;
        }

        /* –°—Ç–∞—Ç—É—Å –±–∞—Ä */
        .status-bar {
            background: var(--arbuz-green); color: white; padding: 8px 16px;
            font-size: 13px; display: flex; justify-content: space-between; align-items: center; font-family: 'Roboto', sans-serif;
        }

        /* –ö–æ–Ω—Ç–µ–Ω—Ç */
        .content { flex: 1; padding: 20px; display: flex; flex-direction: column; overflow-y: auto; }
        .screen { display: none; flex-direction: column; min-height: 100%; }
        .screen.active { display: flex; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* –¢–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞ */
        h1 { margin: 0 0 10px 0; font-size: 24px; font-weight: 800; color: #222; text-align: center; }
        p { color: #555; font-size: 16px; line-height: 1.5; margin-bottom: 24px; text-align: center; }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card { background: white; border-radius: 16px; padding: 16px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
        .card-row { display: flex; align-items: center; margin-bottom: 12px; }
        .card-row:last-child { margin-bottom: 0; }
        .card-icon { font-size: 28px; width: 40px; text-align: center; margin-right: 12px; }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            background: var(--arbuz-green); color: white; border: none; padding: 16px;
            font-size: 18px; font-weight: 700; border-radius: 12px; width: 100%;
            cursor: pointer; box-shadow: 0 4px 10px rgba(0,160,70,0.3); margin-top: 20px;
        }
        .btn:active { transform: scale(0.98); }
        
        /* –ö–Ω–æ–ø–∫–∞ Dev */
        .dev-btn { position: absolute; bottom: 5px; right: 5px; opacity: 0.15; font-size: 11px; z-index: 999; border: 1px solid #333; padding: 2px 5px; background: #eee; }

        /* --- –°–¢–ò–õ–ò WMS (–°–ë–û–†–ö–ê) --- */
        .wms-header {
            display: flex; justify-content: space-between; background: white; padding: 15px 10px;
            border-bottom: 1px solid #eee; margin: -20px -20px 15px -20px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.03);
        }
        .wms-addr-block { text-align: center; flex: 1; }
        .wms-addr-val { font-size: 26px; font-weight: 700; color: #222; display: block; font-family: 'Roboto', sans-serif; line-height: 1; margin-bottom: 4px;}
        .wms-addr-lbl { font-size: 11px; color: #999; text-transform: lowercase; }

        .wms-product-card {
            background: white; border-radius: 8px; padding: 12px; display: flex; gap: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 20px; border: 1px solid #eee;
        }
        .prod-info { flex: 1; display: flex; flex-direction: column; gap: 4px; }
        .prod-title { font-weight: 700; font-size: 15px; color: #222; line-height: 1.3; }
        .prod-meta { font-size: 12px; color: #777; }
        .prod-img-box { width: 90px; height: 90px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; background: #fff; border-radius: 4px; border: 1px solid #f0f0f0; }
        .prod-img { width: 100%; height: 100%; object-fit: contain; }

        /* –ü–æ–ª–µ –≤–≤–æ–¥–∞ */
        .scan-input { width: 100%; padding: 15px; font-size: 18px; border: 2px solid #ddd; border-radius: 10px; box-sizing: border-box; font-family: monospace; outline: none; text-align: center; }
        .scan-input:focus { border-color: var(--arbuz-green); background: #fff; }

        /* –°—á–µ—Ç—á–∏–∫–∏ */
        .counters-row { display: flex; gap: 15px; margin-bottom: 25px; align-items: flex-end; }
        .qty-box { flex: 1; text-align: center; border-radius: 8px; padding: 10px; position: relative; height: 70px; display: flex; align-items: center; justify-content: center; }
        .qty-label { position: absolute; top: -20px; left: 0; width: 100%; font-size: 12px; color: #777; text-align: center; }
        .qty-red { background: var(--arbuz-red); color: white; box-shadow: 0 4px 12px rgba(226, 30, 44, 0.25); transition: background 0.3s; }
        .qty-red.done { background: var(--arbuz-green); }
        .qty-val { font-size: 38px; font-weight: 700; }
        .qty-white { background: white; border: 2px solid var(--arbuz-green); color: var(--arbuz-green); box-sizing: border-box; }

        /* –ù–∏–∂–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ */
        .bottom-actions { 
            display: flex; justify-content: space-between; margin-top: auto; 
            padding-top: 15px; padding-bottom: 10px;
        }
        .action-item { display: flex; flex-direction: column; align-items: center; gap: 8px; width: 70px; cursor: pointer; position: relative; }
        .circle-btn {
            width: 56px; height: 56px; border-radius: 50%; border: none;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; transition: transform 0.1s; position: relative;
        }
        .circle-btn:active { transform: scale(0.95); }
        .btn-gray { background: #E0E0E0; color: #666; }
        .btn-check { background: #E0E0E0; color: #999; transition: all 0.3s;}
        .btn-check.ready { background: var(--arbuz-green); color: white; box-shadow: 0 4px 10px rgba(0,160,70,0.3); animation: pulseGreen 2s infinite; }
        .act-label { font-size: 11px; color: #999; text-align: center; line-height: 1.2;}

        /* –ü–æ–¥—Å–∫–∞–∑–∫–∏ */
        .hint-marker {
            position: absolute; top: -2px; right: -2px;
            background: var(--hint-blue); color: white; border-radius: 50%;
            width: 18px; height: 18px; font-size: 12px; font-weight: bold;
            display: flex; align-items: center; justify-content: center;
            border: 2px solid white; animation: pulseBlue 2s infinite;
        }
        
        .step-help-icon {
            cursor: pointer; background: #E3F2FD; border-radius: 50%; width: 20px; height: 20px; 
            display: inline-flex; align-items: center; justify-content: center; 
            font-weight: bold; font-size: 12px; color: #1976D2; border: 1px solid #BBDEFB; margin-left: 5px;
        }

        @keyframes pulseGreen { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        @keyframes pulseBlue { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 90; display: none; }
        .bottom-sheet { position: fixed; bottom: -100%; left: 0; width: 100%; background: white; border-top-left-radius: 20px; border-top-right-radius: 20px; padding: 24px; box-sizing: border-box; transition: bottom 0.3s; z-index: 100; }
        .bottom-sheet.active { bottom: 0; }
        
        .addr-badge { color: white; padding: 4px 8px; border-radius: 6px; font-family: monospace; font-weight: bold; margin-right: 12px; min-width: 32px; text-align: center; }
        .target-box { background: #E8F5E9; border: 2px dashed var(--arbuz-green); border-radius: 16px; padding: 20px; text-align: center; margin-bottom: 20px; }
        .target-val { font-size: 32px; font-weight: 800; color: #333; font-family: monospace; }
        .hint-btn { color: #1976D2; font-weight: 600; cursor: pointer; text-align: center; padding: 10px; display: block;}
    </style>
</head>
<body>

    <div class="device-screen">
        <div class="status-bar">
            <span>Arbuz WMS v4.2</span>
            <span id="clock">10:00</span>
        </div>

        <div class="content" id="main-content">
            </div>
    </div>

    <div class="overlay" id="overlay" onclick="closeHint()"></div>
    <div class="bottom-sheet" id="hint-sheet">
        <h3 style="margin-top:0; text-align:center;" id="hint-title">–ü–æ–¥—Å–∫–∞–∑–∫–∞</h3>
        <div id="hint-text" style="line-height: 1.6; color: #444; font-size: 15px;"></div>
        <button class="btn" style="padding: 12px;" onclick="closeHint()">–ü–æ–Ω—è—Ç–Ω–æ</button>
    </div>

    <script>
        // --- –î–ê–ù–ù–´–ï –ó–ê–î–ê–ù–ò–ô –ò –¢–û–í–ê–†–û–í ---

        // 1. –ü–æ–∏—Å–∫ –ª–æ–∫–∞—Ü–∏–π (Part 1)
        const locTasks = {
            1: { target: "B1-02-05-A-01", hint: "<p><b>B1</b> ‚Äî –ë–∞–∫–∞–ª–µ—è.</p><p><b>02</b> ‚Äî –†—è–¥ 2.</p><p><b>05</b> ‚Äî –°—Ç–µ–ª–ª–∞–∂ 5.</p><p><b>A</b> ‚Äî –ù–∏–∂–Ω—è—è –ø–æ–ª–∫–∞.</p>" },
            2: { target: "G1-02-03-D-02", hint: "<p><b>G</b> ‚Äî –ì–ú–ó (–ì–∞—Å—Ç—Ä–æ–Ω–æ–º).</p><p>‚ùÑÔ∏è <b>–í–ù–ò–ú–ê–ù–ò–ï:</b> –¢—É—Ç —Ö–æ–ª–æ–¥–Ω–æ!</p><p>–ù–∞–¥–µ–Ω—å –∫—É—Ä—Ç–∫—É –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –∏–¥—Ç–∏ –≤ —ç—Ç–æ—Ç —Ä—è–¥.</p>" }
        };

        // 2. –ü—Ä–æ—Å—Ç–æ–π –∑–∞–∫–∞–∑ (–ì–æ—Ä–æ—à–µ–∫) (Part 2)
        const trainingOrder = {
            id: "train_01",
            addr: { sec: "B1", row: "01", rack: "01", shelf: "B", cell: "02" },
            product: {
                name: "–ì–æ—Ä–æ—à–µ–∫ Bonduelle –∫–æ–Ω—Å–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, 425 –º–ª",
                barcode: "3083680048774", 
                // –°—Å—ã–ª–∫–∞ —Å Kaspi (–Ω–∞–¥–µ–∂–Ω–∞—è)
                img: "https://resources.cdn-kaspi.kz/img/m/p/h90/h2d/63820987924510.jpg",
                qty: 1
            }
        };

        // 3. –°–ª–æ–∂–Ω—ã–π –∑–∞–∫–∞–∑ (–ë–∞–Ω–∞–Ω—ã + –°–º–µ—Ç–∞–Ω–∞) (Part 3)
        const complexOrderItems = [
            {
                id: 1,
                addr: { sec: "F1", row: "02", rack: "04", shelf: "A", cell: "01" }, // –§—Ä–µ—à
                product: {
                    name: "–ë–∞–Ω–∞–Ω—ã (–í–µ—Å–æ–≤—ã–µ)",
                    barcode: "2001001",
                    // –°—Å—ã–ª–∫–∞ —Å Kaspi (–Ω–∞–¥–µ–∂–Ω–∞—è)
                    img: "https://resources.cdn-kaspi.kz/img/m/p/h3e/h53/63952793665566.jpg",
                    qty: 2, // 2 –∫–≥
                    step: 1, 
                    stepLabel: "–®–∞–≥ —Ñ–∞—Å–æ–≤–∫–∏: 1 –∫–≥",
                    stepHint: "–û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ: –∫–ª–∏–µ–Ω—Ç –∑–∞–∫–∞–∑–∞–ª –¥–≤–∞ –∫–∏–ª–æ–≥—Ä–∞–º–º–∞, –∞ —Ñ–∞—Å–æ–≤–∫–∞ –ø–æ –æ–¥–Ω–æ–º—É –∫–∏–ª–æ–≥—Ä–∞–º–º—É. –¢–µ–±–µ –Ω–∞–¥–æ –≤–∑—è—Ç—å –¥–≤–∞ –ø–∞–∫–µ—Ç–∞ –ø–æ –∫–∏–ª–æ–≥—Ä–∞–º–º—É."
                }
            },
            {
                id: 2,
                addr: { sec: "G1", row: "01", rack: "02", shelf: "C", cell: "03" }, // –ì–ú–ó
                product: {
                    name: "–°–º–µ—Ç–∞–Ω–∞ President 15%, 400 –≥",
                    barcode: "4870055001231",
                    // –°—Å—ã–ª–∫–∞ —Å Kaspi (–Ω–∞–¥–µ–∂–Ω–∞—è)
                    img: "https://resources.cdn-kaspi.kz/img/m/p/h06/h53/63953874059294.jpg",
                    qty: 1
                }
            }
        ];

        // --- –°–û–°–¢–û–Ø–ù–ò–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ---
        let state = {
            screen: 'welcome',
            orderType: null, // 'training' or 'complex'
            currentItemIndex: 0,
            pickedQty: 0
        };

        // --- –®–ê–ë–õ–û–ù–´ –≠–ö–†–ê–ù–û–í ---
        
        // 1. –ü–†–ò–í–ï–¢–°–¢–í–ò–ï
        function renderWelcome() {
            document.getElementById('main-content').innerHTML = `
                <div class="screen active" style="text-align: center; margin-top: 30px;">
                    <div style="font-size: 60px; margin-bottom: 10px;">üçâ</div>
                    <h1>–ü—Ä–∏–≤–µ—Ç, —Å—Ç–∞–∂—ë—Ä!</h1>
                    <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–æ–º–∞–Ω–¥—É.<br>–ß—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ —Å–æ–±–∏—Ä–∞—Ç—å –∑–∞–∫–∞–∑—ã, –Ω—É–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω –Ω–∞—à —Å–∫–ª–∞–¥.</p>
                    <button class="btn" onclick="renderZones()">–ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ üöÄ</button>
                </div>
            `;
        }

        // 2. –ó–û–ù–´
        function renderZones() {
            document.getElementById('main-content').innerHTML = `
                <div class="screen active">
                    <h1>–†–µ–≥–∏–æ–Ω—ã —Å–∫–ª–∞–¥–∞</h1>
                    <p>5 –≥–ª–∞–≤–Ω—ã—Ö –æ—Ç–¥–µ–ª–æ–≤ —Ö—Ä–∞–Ω–µ–Ω–∏—è:</p>
                    <div class="card"><div class="card-row"><div class="card-icon">üçù</div><div><b>B ‚Äî –ë–∞–∫–∞–ª–µ—è (Food)</b><br><span style="font-size:12px; color:#777;">–ö—Ä—É–ø—ã, –∫–æ–Ω—Å–µ—Ä–≤—ã</span></div></div></div>
                    <div class="card"><div class="card-row"><div class="card-icon">üß¥</div><div><b>M ‚Äî –•–∏–º–∏—è (Non Food)</b><br><span style="font-size:12px; color:#777;">–ë—ã—Ç–æ–≤–∞—è —Ö–∏–º–∏—è</span></div></div></div>
                    <div class="card"><div class="card-row"><div class="card-icon">üçâ</div><div><b>F ‚Äî –§—Ä–µ—à</b><br><span style="font-size:12px; color:#777;">–°–≤–µ–∂–∏–µ —Ñ—Ä—É–∫—Ç—ã</span></div></div></div>
                    <div class="card"><div class="card-row"><div class="card-icon">üç¶</div><div><b>G ‚Äî –ì–ú–ó</b><br><span style="font-size:12px; color:#777;">–ú–æ–ª–æ—á–∫–∞, –∑–∞–º–æ—Ä–æ–∑–∫–∞</span></div></div></div>
                    <div class="card"><div class="card-row"><div class="card-icon">üíä</div><div><b>PH ‚Äî –ê–ø—Ç–µ–∫–∞</b><br><span style="font-size:12px; color:#777;">–õ–µ–∫–∞—Ä—Å—Ç–≤–∞</span></div></div></div>
                    <button class="btn" onclick="renderAddress()">–í—Å—ë –ø–æ–Ω—è—Ç–Ω–æ üëâ</button>
                </div>
            `;
        }

        // 3. –ê–î–†–ï–° (–ì–û–†–û–î)
        function renderAddress() {
            document.getElementById('main-content').innerHTML = `
                <div class="screen active">
                    <h1>–ê–¥—Ä–µ—Å —è—á–µ–π–∫–∏</h1>
                    <p>–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ –∏—â–µ—à—å –¥—Ä—É–≥–∞ –≤ –≥–æ—Ä–æ–¥–µ:</p>
                    <div class="target-box" style="padding:10px;"><span style="font-family:monospace; font-weight:bold; font-size:20px;">B1-02-05-A-01</span></div>
                    <div class="card">
                        <div class="card-row"><span class="addr-badge" style="background:#FF5722;">B1</span><div><b>–ì–æ—Ä–æ–¥</b> (–û—Ç–¥–µ–ª)</div></div>
                        <div class="card-row"><span class="addr-badge" style="background:#2196F3;">02</span><div><b>–£–ª–∏—Ü–∞</b> (–†—è–¥)</div></div>
                        <div class="card-row"><span class="addr-badge" style="background:#9C27B0;">05</span><div><b>–î–æ–º</b> (–°—Ç–µ–ª–ª–∞–∂)</div></div>
                        <div class="card-row"><span class="addr-badge" style="background:#E91E63;">A</span><div><b>–≠—Ç–∞–∂</b> (–ü–æ–ª–∫–∞)</div></div>
                        <div class="card-row"><span class="addr-badge" style="background:var(--arbuz-green);">01</span><div><b>–ö–≤–∞—Ä—Ç–∏—Ä–∞</b> (–ü–æ–∑–∏—Ü–∏—è)</div></div>
                    </div>
                    <button class="btn" onclick="startLocTask(1)">–ó–∞–ø–æ–º–Ω–∏–ª, –∫ –ø—Ä–∞–∫—Ç–∏–∫–µ! üî•</button>
                </div>
            `;
        }

        // 4. –ü–û–ò–°–ö –õ–û–ö–ê–¶–ò–ò (–ó–ê–î–ê–ù–ò–ï 1 –∏ 2)
        function startLocTask(num) {
            state.screen = 'locTask' + num;
            const task = locTasks[num];
            
            document.getElementById('main-content').innerHTML = `
                <div class="screen active">
                    <h1>–ó–∞–¥–∞–Ω–∏–µ ‚Ññ${num}</h1>
                    <p>${num === 1 ? '–ù–∞–π–¥–∏ –∞–¥—Ä–µ—Å –∏ —Å–∫–∞–Ω–∏—Ä—É–π:' : '–¢–µ–ø–µ—Ä—å –Ω–∞–π–¥–∏ —Ö–æ–ª–æ–¥–Ω—É—é –∑–æ–Ω—É:'}</p>
                    <div class="target-box" style="${num === 2 ? 'border-color:#2196F3; background:#E3F2FD;' : ''}">
                        <div style="font-size:12px; color:${num === 2 ? '#1565C0' : '#E65100'}; font-weight:bold; margin-bottom:5px;">–¶–ï–õ–¨</div>
                        <div class="target-val">${task.target}</div>
                    </div>
                    <div class="hint-btn" onclick="showHint('${task.hint}')">ü§î –ü–æ–¥—Å–∫–∞–∑–∫–∞</div>
                    <div style="margin-top:10px;">
                        <input type="text" id="barcode-input" class="scan-input" placeholder="–°–∫–∞–Ω–∏—Ä—É–π —è—á–µ–π–∫—É..." autocomplete="off">
                    </div>
                    <button class="dev-btn" onclick="simulateScan('${task.target}')">[DEV: OK]</button>
                </div>
            `;
            initInput();
        }

        // 5. –£–°–ü–ï–• –û–ù–ë–û–†–î–ò–ù–ì–ê
        function renderOnboardingSuccess() {
            document.getElementById('main-content').innerHTML = `
                <div class="screen active" style="text-align: center; justify-content:center; height:100%;">
                    <div style="font-size: 70px; margin-bottom: 20px;">üéì</div>
                    <h1 style="color: var(--arbuz-green);">–ü–µ—Ä–≤—ã–π —ç—Ç–∞–ø –ø—Ä–æ–π–¥–µ–Ω!</h1>
                    <p>–¢—ã –∏–∑—É—á–∏–ª –∑–æ–Ω—ã –∏ –Ω–∞—É—á–∏–ª—Å—è –Ω–∞—Ö–æ–¥–∏—Ç—å —è—á–µ–π–∫–∏.</p>
                    <div class="card" style="margin-top:20px; background:#E8F5E9;">
                        <p style="margin:0; color:#2e7d32;"><b>–ü—Ä–µ–¥—Å—Ç–∞–≤—å:</b><br>–¢—ã –ø–æ–ª—É—á–∏–ª –ø–µ—Ä–≤—ã–π —Ä–µ–∞–ª—å–Ω—ã–π –∑–∞–∫–∞–∑ –Ω–∞ —Å–±–æ—Ä–∫—É.</p>
                    </div>
                    <button class="btn" style="background:#00A046; color:white; margin-top:30px;" onclick="startTrainingOrder()">–ù–∞—á–∞—Ç—å –æ—Ç–±–æ—Ä üì¶</button>
                </div>
            `;
        }

        // 6. –≠–ö–†–ê–ù –°–ë–û–†–ö–ò (WMS)
        function renderWmsScreen(item) {
            const isTraining = state.orderType === 'training';
            const hintMarker = isTraining ? `<div class="hint-marker">?</div>` : ``;

            let stepHtml = '';
            if (item.product.stepLabel) {
                stepHtml = `
                    <div style="font-size:13px; color:#1976D2; margin-top:5px; font-weight:600; display:flex; align-items:center; gap:6px;">
                        ${item.product.stepLabel} 
                        <div class="step-help-icon" onclick="showHint('${item.product.stepHint}')">?</div>
                    </div>
                `;
            }

            document.getElementById('main-content').innerHTML = `
                <div class="screen active" style="padding:0;">
                    <div class="wms-header">
                        <div class="wms-addr-block"><span class="wms-addr-val">${item.addr.sec}</span><span class="wms-addr-lbl">—Å–µ–∫—Ü–∏—è</span></div>
                        <div class="wms-addr-block"><span class="wms-addr-val">${item.addr.row}</span><span class="wms-addr-lbl">—Ä—è–¥</span></div>
                        <div class="wms-addr-block"><span class="wms-addr-val">${item.addr.rack}</span><span class="wms-addr-lbl">—Å—Ç–µ–ª–ª–∞–∂</span></div>
                        <div class="wms-addr-block"><span class="wms-addr-val">${item.addr.shelf}</span><span class="wms-addr-lbl">–ø–æ–ª–∫–∞</span></div>
                        <div class="wms-addr-block"><span class="wms-addr-val">${item.addr.cell}</span><span class="wms-addr-lbl">—è—á–µ–π–∫–∞</span></div>
                    </div>

                    <div style="padding: 0 15px;">
                        <div style="font-size:12px; color:#777; margin-bottom:5px;">–ó–∞–¥–∞–Ω–∏–µ ${state.currentItemIndex + 1}</div>
                        
                        <div class="wms-product-card">
                            <div class="prod-info">
                                <div class="prod-title">${item.product.name}</div>
                                <div class="prod-meta">–®–ö: ${item.product.barcode}</div>
                                ${stepHtml}
                                ${item.product.qty > 1 && !item.product.stepLabel ? '<div style="color:#E65100; font-size:12px; font-weight:bold; margin-top:4px;">‚ö†Ô∏è –°–∫–∞–Ω–∏—Ä—É–π –∫–∞–∂–¥—É—é –µ–¥–∏–Ω–∏—Ü—É!</div>' : ''}
                            </div>
                            <div class="prod-img-box">
                                <img src="${item.product.img}" class="prod-img" alt="–§–æ—Ç–æ">
                            </div>
                        </div>

                        <div style="display:flex; gap:8px; margin-bottom:20px;">
                            <input type="text" id="barcode-input" class="scan-input" style="text-align:left; font-size:16px;" placeholder="–°–∫–∞–Ω–∏—Ä—É–π —Ç–æ–≤–∞—Ä..." autocomplete="off">
                            <button style="background:white; border:1px solid #ddd; border-radius:8px; width:50px; font-size:20px; color:#666;">‚Üí</button>
                        </div>

                        <div class="counters-row">
                            <div class="qty-box qty-red" id="qty-box-bg">
                                <span class="qty-label">–û—Ç–æ–±—Ä–∞–Ω–æ</span>
                                <span class="qty-val" id="picked-val">${state.pickedQty}</span>
                            </div>
                            <div style="padding-bottom:25px; color:#777;">–∏–∑</div>
                            <div class="qty-box qty-white">
                                <span class="qty-label">–ó–∞–∫–∞–∑–∞–Ω–æ</span>
                                <span class="qty-val">${item.product.qty}</span>
                            </div>
                        </div>
                    </div>

                    <div class="bottom-actions" style="padding: 10px 20px;">
                        <div class="action-item">
                            <button class="circle-btn btn-gray">‚Üê</button>
                            <span class="act-label">–ù–∞–∑–∞–¥</span>
                        </div>
                        <div class="action-item" onclick="showReplaceHint()">
                            <button class="circle-btn btn-gray">‚Üª</button>
                            ${hintMarker}
                            <span class="act-label">–ó–∞–º–µ–Ω–∏—Ç—å</span>
                        </div>
                        <div class="action-item" onclick="confirmItem()">
                            <button class="circle-btn btn-check" id="btn-confirm">‚úì</button>
                            <span class="act-label">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</span>
                        </div>
                        <div class="action-item" onclick="showNotFoundHint()">
                            <button class="circle-btn btn-gray">‚úï</button>
                            ${hintMarker}
                            <span class="act-label">–ù–µ –Ω–∞–π–¥–µ–Ω</span>
                        </div>
                    </div>
                    
                    <button class="dev-btn" onclick="simulateScan('${item.product.barcode}')">[DEV: OK]</button>
                </div>
            `;
            initInput();
        }

        // 7. –≠–ö–†–ê–ù–´ –£–°–ü–ï–•–ê
        function renderSimpleSuccess(msg, btnText, action) {
            document.getElementById('main-content').innerHTML = `
                <div class="screen active" style="text-align: center; justify-content:center; height:100%;">
                    <div style="font-size: 80px; margin-bottom: 20px;">‚úÖ</div>
                    <h1 style="color: var(--arbuz-green);">–û—Ç–ª–∏—á–Ω–æ!</h1>
                    <p>${msg}</p>
                    <button class="btn" onclick="${action}">${btnText}</button>
                </div>
            `;
        }

        // --- –õ–û–ì–ò–ö–ê ---

        function initInput() {
            setTimeout(() => {
                const inp = document.getElementById('barcode-input');
                if(inp) {
                    inp.focus();
                    inp.addEventListener('keydown', handleEnter);
                }
            }, 300);
        }

        function startTrainingOrder() {
            state.orderType = 'training';
            state.screen = 'picking'; // –í–ê–ñ–ù–û: –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º!
            state.currentItemIndex = 0;
            state.pickedQty = 0;
            renderWmsScreen(trainingOrder);
        }

        function startComplexOrder() {
            state.orderType = 'complex';
            state.screen = 'picking'; // –í–ê–ñ–ù–û: –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º!
            state.currentItemIndex = 0;
            state.pickedQty = 0;
            renderWmsScreen(complexOrderItems[0]);
        }

        function handleEnter(e) {
            if (e.key === 'Enter' || e.keyCode === 13) checkScan(e.target.value);
        }

        function checkScan(code) {
            const input = document.getElementById('barcode-input');
            code = code.trim();

            // –õ–û–ì–ò–ö–ê 1: –ü–û–ò–°–ö –õ–û–ö–ê–¶–ò–ô (ONBOARDING)
            if (state.screen === 'locTask1') {
                if (code === locTasks[1].target) { alert("–í–µ—Ä–Ω–æ!"); startLocTask(2); }
                else { alert("–û—à–∏–±–∫–∞! –ò—â–µ–º: " + locTasks[1].target); input.value=""; }
                return;
            }
            if (state.screen === 'locTask2') {
                if (code === locTasks[2].target) { renderOnboardingSuccess(); }
                else { alert("–û—à–∏–±–∫–∞! –ò—â–µ–º: " + locTasks[2].target); input.value=""; }
                return;
            }

            // –õ–û–ì–ò–ö–ê 2: –°–ë–û–†–ö–ê –¢–û–í–ê–†–û–í (PICKING)
            if (state.screen === 'picking') {
                let currentItem;
                if (state.orderType === 'training') currentItem = trainingOrder;
                else currentItem = complexOrderItems[state.currentItemIndex];

                if (code === currentItem.product.barcode) {
                    // –£—Å–ø–µ—à–Ω—ã–π —Å–∫–∞–Ω
                    state.pickedQty += 1;
                    document.getElementById('picked-val').innerText = state.pickedQty;
                    input.value = "";
                    input.focus();

                    // –ï—Å–ª–∏ —Å–æ–±—Ä–∞–ª–∏
                    if (state.pickedQty >= currentItem.product.qty) {
                        document.getElementById('qty-box-bg').classList.add('done');
                        const btn = document.getElementById('btn-confirm');
                        btn.classList.add('ready');
                        btn.classList.remove('btn-check');
                        input.blur();
                        input.placeholder = "–ù–∞–∂–º–∏ –≥–∞–ª–æ—á–∫—É ‚úì";
                    }
                } else {
                    alert("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–≤–∞—Ä! \n–û–∂–∏–¥–∞–µ—Ç—Å—è –®–ö: " + currentItem.product.barcode);
                    input.value = "";
                }
            }
        }

        function confirmItem() {
            const btn = document.getElementById('btn-confirm');
            if (!btn.classList.contains('ready')) {
                alert("–°–Ω–∞—á–∞–ª–∞ –æ—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ –Ω—É–∂–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ!");
                return;
            }

            if (state.orderType === 'training') {
                renderSimpleSuccess("–í—ã –æ—Å–≤–æ–∏–ª–∏ –∫–Ω–æ–ø–∫–∏ –∏ —Å–æ–±—Ä–∞–ª–∏ –ø—Ä–æ—Å—Ç–æ–π –∑–∞–∫–∞–∑.", "–ü–µ—Ä–µ–π—Ç–∏ –∫ –°–ª–æ–∂–Ω–æ–º—É –∑–∞–∫–∞–∑—É üî•", "startComplexOrder()");
            } 
            else if (state.orderType === 'complex') {
                if (state.currentItemIndex >= complexOrderItems.length - 1) {
                    renderSimpleSuccess("–°–ª–æ–∂–Ω—ã–π –∑–∞–∫–∞–∑ –∏–∑ 2 –ø–æ–∑–∏—Ü–∏–π —Å–æ–±—Ä–∞–Ω!", "–ó–∞–∫–æ–Ω—á–∏—Ç—å —Å–º–µ–Ω—É üè†", "location.reload()");
                } else {
                    state.currentItemIndex++;
                    state.pickedQty = 0;
                    alert("–ü–æ–∑–∏—Ü–∏—è –ø—Ä–∏–Ω—è—Ç–∞! –°–ª–µ–¥—É—é—â–∏–π —Ç–æ–≤–∞—Ä...");
                    renderWmsScreen(complexOrderItems[state.currentItemIndex]);
                }
            }
        }

        // --- –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï ---
        function showHint(htmlText) {
            document.getElementById('hint-title').innerText = "–ü–æ–¥—Å–∫–∞–∑–∫–∞";
            document.getElementById('hint-text').innerHTML = htmlText;
            openOverlay();
        }

        function showReplaceHint() {
            showHint("–ù–∞–∂–∏–º–∞–π, –µ—Å–ª–∏:<br>1. –ü—Ä–∏—à–µ–ª –∫ —è—á–µ–π–∫–µ.<br>2. –¢–æ–≤–∞—Ä–∞ –Ω–µ—Ç.<br>3. –ö–Ω–æ–ø–∫–∞ <b>–ê–ö–¢–ò–í–ù–ê</b>.<br><br>üëâ –ù—É–∂–Ω–æ –ø–æ–¥–æ–±—Ä–∞—Ç—å –∞–Ω–∞–ª–æ–≥ –∏ —Å–æ–æ–±—â–∏—Ç—å —Å—É–ø–µ—Ä–≤–∞–π–∑–µ—Ä—É.");
        }

        function showNotFoundHint() {
            showHint("–ù–∞–∂–∏–º–∞–π, –µ—Å–ª–∏:<br>1. –¢–æ–≤–∞—Ä–∞ –Ω–µ—Ç.<br>2. ¬´–ó–∞–º–µ–Ω–∏—Ç—å¬ª <b>–ù–ï –ê–ö–¢–ò–í–ù–ê</b>.<br><br>üëâ –ó–Ω–∞—á–∏—Ç –∫–ª–∏–µ–Ω—Ç –∑–∞–ø—Ä–µ—Ç–∏–ª –∑–∞–º–µ–Ω—É. –ü—Ä–æ—Å—Ç–æ –∂–º–∏ –∫—Ä–µ—Å—Ç–∏–∫.");
        }

        function openOverlay() { document.getElementById('overlay').style.display = 'block'; setTimeout(() => document.getElementById('hint-sheet').classList.add('active'), 10); }
        function closeHint() { document.getElementById('hint-sheet').classList.remove('active'); setTimeout(() => document.getElementById('overlay').style.display = 'none', 300); }
        function simulateScan(code) { checkScan(code); }

        // –ó–ê–ü–£–°–ö
        renderWelcome();
        setInterval(() => document.getElementById('clock').innerText = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}), 1000);

    </script>
</body>
</html>
